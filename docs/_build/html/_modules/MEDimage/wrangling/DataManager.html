<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEDimage.wrangling.DataManager &mdash; MEDimage  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> MEDimage
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">MEDimage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQs.html">FAQs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MEDimage</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>MEDimage.wrangling.DataManager</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MEDimage.wrangling.DataManager</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pydicom</span>
<span class="kn">import</span> <span class="nn">pydicom.errors</span>
<span class="kn">import</span> <span class="nn">pydicom.misc</span>
<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">MEDimage.MEDimage</span> <span class="kn">import</span> <span class="n">MEDimage</span>
<span class="kn">from</span> <span class="nn">MEDimage.processing.segmentation</span> <span class="kn">import</span> <span class="n">get_roi_from_indexes</span>
<span class="kn">from</span> <span class="nn">MEDimage.utils.imref</span> <span class="kn">import</span> <span class="n">imref3d</span>
<span class="kn">from</span> <span class="nn">numpyencoder</span> <span class="kn">import</span> <span class="n">NumpyEncoder</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span><span class="p">,</span> <span class="n">trange</span>

<span class="kn">from</span> <span class="nn">..processing.compute_suv_map</span> <span class="kn">import</span> <span class="n">compute_suv_map</span>
<span class="kn">from</span> <span class="nn">..utils.get_file_paths</span> <span class="kn">import</span> <span class="n">get_file_paths</span>
<span class="kn">from</span> <span class="nn">..utils.get_patient_names</span> <span class="kn">import</span> <span class="n">get_patient_names</span>
<span class="kn">from</span> <span class="nn">..utils.json_utils</span> <span class="kn">import</span> <span class="n">load_json</span><span class="p">,</span> <span class="n">save_json</span>
<span class="kn">from</span> <span class="nn">..utils.save_MEDimage</span> <span class="kn">import</span> <span class="n">save_MEDimage</span>
<span class="kn">from</span> <span class="nn">.process_dicom_scan_files</span> <span class="kn">import</span> <span class="n">process_dicom_scan_files</span> <span class="k">as</span> <span class="n">pdsf</span>


<div class="viewcode-block" id="DataManager"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager">[docs]</a><span class="k">class</span> <span class="nc">DataManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reads all the raw data (DICOM, NIfTI) content and organizes it in instances of the MEDimage class.&quot;&quot;&quot;</span>


<div class="viewcode-block" id="DataManager.DICOM"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.DICOM">[docs]</a>    <span class="nd">@dataclass</span>
    <span class="k">class</span> <span class="nc">DICOM</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DICOM data management class that will organize data during the conversion to MEDimage class process&quot;&quot;&quot;</span>
        <span class="n">stack_series_rs</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">stack_path_rs</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">stack_frame_rs</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">cell_series_id</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">cell_path_rs</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">cell_path_images</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">cell_frame_rs</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">cell_frame_id</span><span class="p">:</span> <span class="n">List</span></div>


<div class="viewcode-block" id="DataManager.NIfTI"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.NIfTI">[docs]</a>    <span class="nd">@dataclass</span>
    <span class="k">class</span> <span class="nc">NIfTI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;NIfTI data management class that will organize data during the conversion to MEDimage class process&quot;&quot;&quot;</span>
        <span class="n">stack_path_images</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">stack_path_roi</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">stack_path_all</span><span class="p">:</span> <span class="n">List</span></div>


<div class="viewcode-block" id="DataManager.Paths"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.Paths">[docs]</a>    <span class="nd">@dataclass</span>
    <span class="k">class</span> <span class="nc">Paths</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Paths management class that will organize the paths used in the processing&quot;&quot;&quot;</span>
        <span class="n">_path_to_dicoms</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">_path_to_niftis</span><span class="p">:</span> <span class="n">List</span>
        <span class="n">_path_csv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="n">_path_save</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="n">_path_save_checks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="n">_path_pre_checks_settings</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></div>

<div class="viewcode-block" id="DataManager.__init__"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">path_to_dicoms</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">path_to_niftis</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">path_csv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">path_save</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">path_save_checks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">path_pre_checks_settings</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">keep_instances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">n_batch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructor of the class DataManager.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_to_dicoms (Union[Path, str], optional): Full path to the starting directory</span>
<span class="sd">                where the DICOM data is located.</span>
<span class="sd">            path_to_niftis (Union[Path, str], optional): Full path to the starting directory</span>
<span class="sd">                where the NIfTI is located.</span>
<span class="sd">            path_csv (Union[Path, str], optional): Full path to the CSV file containing the scans info list.</span>
<span class="sd">            path_save (Union[Path, str], optional): Full path to the directory where to save all the MEDimage classes.</span>
<span class="sd">            path_save_checks(Union[Path, str], optional): Full path to the directory where to save all </span>
<span class="sd">                the pre-radiomics checks analysis results.</span>
<span class="sd">            path_pre_checks_settings(Union[Path, str], optional): Full path to the JSON file of the pre-checks analysis</span>
<span class="sd">                parameters.</span>
<span class="sd">            save (bool, optional): True to save the MEDimage classes in `path_save`.</span>
<span class="sd">            keep_instances(bool, optional): If True, will keep the created MEDimage instances in the class instance.</span>
<span class="sd">            n_batch (int, optional): Numerical value specifying the number of batch to use in the</span>
<span class="sd">                parallel computations (use 0 for serial computation).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert all paths to Pathlib.Path</span>
        <span class="k">if</span> <span class="n">path_to_dicoms</span><span class="p">:</span>
            <span class="n">path_to_dicoms</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_to_dicoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_to_niftis</span><span class="p">:</span>
            <span class="n">path_to_niftis</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_to_niftis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_csv</span><span class="p">:</span>
            <span class="n">path_csv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_csv</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_save</span><span class="p">:</span>
            <span class="n">path_save</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_save</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_save_checks</span><span class="p">:</span>
            <span class="n">path_save_checks</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_save_checks</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_pre_checks_settings</span><span class="p">:</span>
            <span class="n">path_pre_checks_settings</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_pre_checks_settings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Paths</span><span class="p">(</span>
                <span class="n">path_to_dicoms</span><span class="p">,</span>
                <span class="n">path_to_niftis</span><span class="p">,</span>
                <span class="n">path_csv</span><span class="p">,</span>
                <span class="n">path_save</span><span class="p">,</span>
                <span class="n">path_save_checks</span><span class="p">,</span>
                <span class="n">path_pre_checks_settings</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="n">save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_instances</span> <span class="o">=</span> <span class="n">keep_instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_batch</span> <span class="o">=</span> <span class="n">n_batch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DICOM</span><span class="p">(</span>
                <span class="n">stack_series_rs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">stack_path_rs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">stack_frame_rs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">cell_series_id</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">cell_path_rs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">cell_path_images</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">cell_frame_rs</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">cell_frame_id</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NIfTI</span><span class="p">(</span>
                <span class="n">stack_path_images</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">stack_path_roi</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">stack_path_all</span><span class="o">=</span><span class="p">[]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csv_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">__find_uid_cell_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">cell</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;Finds the cell with the same `uid`. If not is present in `cell`, creates a new position</span>
<span class="sd">        in the `cell` for the new `uid`.</span>

<span class="sd">        Args:</span>
<span class="sd">            uid (Union[str, List[str]]):  Unique identifier of the Series to find.</span>
<span class="sd">            cell (List[str]): List of Unique identifiers of the Series.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[List[str], str]: List or string of the uid  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="p">)]</span> <span class="k">if</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cell</span> <span class="k">else</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">uid</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__get_list_of_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets all files in the given directory</span>

<span class="sd">        Args:</span>
<span class="sd">            dir_name (str): directory name</span>

<span class="sd">        Returns:</span>
<span class="sd">            List: List of all files in the directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_of_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">list_of_file</span><span class="p">:</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                <span class="n">all_files</span> <span class="o">=</span> <span class="n">all_files</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_list_of_files</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">all_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_files</span>

    <span class="k">def</span> <span class="nf">__get_MEDimage_name_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MEDimg</span><span class="p">:</span> <span class="n">MEDimage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns the name that will be used to save the MEDimage instance, based on the values of the attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            MEDimg(MEDimage): A MEDimage class instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: String of the name save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">series_description</span> <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">series_description</span><span class="o">.</span><span class="n">translate</span><span class="p">({</span><span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span> <span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1"> ()&amp;:*&#39;</span><span class="p">})</span>
        <span class="n">name_id</span> <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">patientID</span><span class="o">.</span><span class="n">translate</span><span class="p">({</span><span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span> <span class="s1">&#39;-&#39;</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s1">&#39;/</span><span class="se">\\</span><span class="s1"> ()&amp;:*&#39;</span><span class="p">})</span>
        <span class="c1"># final saving name</span>
        <span class="n">name_complete</span> <span class="o">=</span> <span class="n">name_id</span> <span class="o">+</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">series_description</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">type</span> <span class="o">+</span> <span class="s1">&#39;.npy&#39;</span>
        <span class="k">return</span> <span class="n">name_complete</span>

    <span class="k">def</span> <span class="nf">__associate_rt_stuct</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Associates the imaging volumes to their mask using UIDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt; Associating all RT objects to imaging volumes&#39;</span><span class="p">)</span>
        <span class="n">n_rs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_path_rs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_rs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_rs</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span> <span class="c1"># PUT ALL THE DICOM PATHS WITH THE SAME UID IN THE SAME PATH LIST</span>
                    <span class="n">ind_series_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_uid_cell_index</span><span class="p">(</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_series_rs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_series_id</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind_series_id</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_rs</span><span class="p">[</span><span class="n">ind_series_id</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_path_rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ind_series_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_uid_cell_index</span><span class="p">(</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_frame_rs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_frame_id</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind_series_id</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_rs</span><span class="p">[</span><span class="n">ind_series_id</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_path_rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__read_all_dicoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reads all the dicom files in the all the paths of the attribute `_path_to_dicoms`</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># SCANNING ALL FOLDERS IN INITIAL DIRECTORY</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--&gt; Scanning all folders in initial directory...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_to_dicoms</span><span class="p">)</span>
        <span class="n">e_rglob</span> <span class="o">=</span> <span class="s1">&#39;*.[!xlsx,!xls,!py,!.DS_Store,!csv,!.,!txt,!..,!TXT,!npy,!m,!CT.npy]*&#39;</span>

        <span class="c1"># EXTRACT ALL FILES IN THE PATH TO DICOMS</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_to_dicoms</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">stack_folder_temp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">e_rglob</span><span class="p">))</span>
            <span class="n">stack_folder</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">stack_folder_temp</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_to_dicoms</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_to_dicoms</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">stack_folder_temp</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">directory_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stack_folder_temp</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">stack_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_list_of_files</span><span class="p">(</span><span class="n">directory_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The given dicom folder path either doesn&#39;t exist or not a folder.&quot;</span><span class="p">)</span>
        <span class="c1"># READ ALL DICOM FILES AND UPDATE ATTRIBUTES FOR FURTHER PROCESSING</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">stack_folder</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">is_dicom</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">Modality</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MR&#39;</span><span class="p">,</span> <span class="s1">&#39;PT&#39;</span><span class="p">,</span> <span class="s1">&#39;CT&#39;</span><span class="p">]:</span>
                        <span class="n">ind_series_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_uid_cell_index</span><span class="p">(</span>
                                                        <span class="n">info</span><span class="o">.</span><span class="n">SeriesInstanceUID</span><span class="p">,</span> 
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_series_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">ind_series_id</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_series_id</span><span class="p">):</span>  <span class="c1"># New volume</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_series_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_series_id</span> <span class="o">+</span> <span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">SeriesInstanceUID</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_frame_id</span> <span class="o">+=</span> <span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">FrameOfReferenceUID</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_images</span> <span class="o">+=</span> <span class="p">[[]]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_rs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_rs</span> <span class="o">+</span> <span class="p">[[]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_images</span><span class="p">[</span><span class="n">ind_series_id</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">file</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">info</span><span class="o">.</span><span class="n">Modality</span> <span class="o">==</span> <span class="s1">&#39;RTSTRUCT&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_path_rs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">file</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">series_uid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">ReferencedFrameOfReferenceSequence</span><span class="p">[</span>
                                        <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">RTReferencedStudySequence</span><span class="p">[</span>
                                        <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">RTReferencedSeriesSequence</span><span class="p">[</span>
                                        <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SeriesInstanceUID</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">series_uid</span> <span class="o">=</span> <span class="s1">&#39;NotFound&#39;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_series_rs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">series_uid</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">frame_uid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">ReferencedFrameOfReferenceSequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">FrameOfReferenceUID</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">frame_uid</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">FrameOfReferenceUID</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">stack_frame_rs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">frame_uid</span><span class="p">]</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error while reading: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">, error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>

        <span class="c1"># ASSOCIATE ALL VOLUMES TO THEIR MASK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__associate_rt_stuct</span><span class="p">()</span>

<div class="viewcode-block" id="DataManager.process_all_dicoms"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.process_all_dicoms">[docs]</a>    <span class="k">def</span> <span class="nf">process_all_dicoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MEDimage</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;This function reads the DICOM content of all the sub-folder tree of a starting directory defined by</span>
<span class="sd">        `path_to_dicoms`. It then organizes the data (files throughout the starting directory are associated by</span>
<span class="sd">        &#39;SeriesInstanceUID&#39;) in the MEDimage class including the region of  interest (ROI) defined by an</span>
<span class="sd">        associated RTstruct. All MEDimage classes hereby created are saved in `path_save` with a name</span>
<span class="sd">        varying with every scan.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[MEDimage]: List of MEDimage instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">local_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_dashboard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt; Reading all DICOM objects to create MEDimage classes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_all_dicoms</span><span class="p">()</span>

        <span class="n">n_scans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_images</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_batch</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">n_scans</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_batch</span><span class="p">:</span>
            <span class="n">n_batch</span> <span class="o">=</span> <span class="n">n_scans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_batch</span>

        <span class="c1"># Distribute the first tasks to all workers</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdsf</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_images</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_rs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_batch</span><span class="p">)]</span>
        <span class="c1"># Update the path to the created instances</span>
        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="n">name_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_MEDimage_name_save</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path_to_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span> <span class="o">/</span> <span class="n">name_save</span><span class="p">))</span>
            <span class="c1"># Update processing summary</span>
            <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">scan_type</span> <span class="o">=</span> <span class="n">name_save</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span> <span class="p">:</span> <span class="n">name_save</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># add new study</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># add new study</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># add new institution</span>
                <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">name_save</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The patient ID of the following file: </span><span class="si">{</span><span class="n">name_save</span><span class="si">}</span><span class="s2"> does not respect the MEDimage &quot;</span>\
                    <span class="s2">&quot;naming convention &#39;study-institution-id&#39; (Ex: Glioma-TCGA-001)&quot;</span><span class="p">)</span>

        <span class="n">nb_job_left</span> <span class="o">=</span> <span class="n">n_scans</span> <span class="o">-</span> <span class="n">n_batch</span>

        <span class="c1"># Get MEDimage instances</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span><span class="p">:</span>
            <span class="c1"># User cannot save over 10 instances in the class</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You have more than 10 MEDimage objects saved in the current DataManager instance, </span><span class="se">\</span>
<span class="s2">                the rest of the instances will/can be saved locally only.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_instances</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>

        <span class="c1"># Distribute the remaining tasks</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="n">n_scans</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">not_ready</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">num_returns</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">not_ready</span>
            <span class="k">if</span> <span class="n">nb_job_left</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">n_scans</span> <span class="o">-</span> <span class="n">nb_job_left</span>
                <span class="n">ids</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">pdsf</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> 
                                        <span class="bp">self</span><span class="o">.</span><span class="n">__dicom</span><span class="o">.</span><span class="n">cell_path_rs</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> 
                                        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)])</span>
                <span class="n">nb_job_left</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="c1"># Update the path to the created instances</span>
            <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
                <span class="n">name_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_MEDimage_name_save</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">path_to_objects</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span> <span class="o">/</span> <span class="n">name_save</span><span class="p">))</span>
                <span class="c1"># Update processing summary</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">scan_type</span> <span class="o">=</span> <span class="n">name_save</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span> <span class="p">:</span> <span class="n">name_save</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># add new study</span>
                    <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># add new study</span>
                    <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># add new institution</span>
                    <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">name_save</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The patient ID of the following file: </span><span class="si">{</span><span class="n">name_save</span><span class="si">}</span><span class="s2"> does not respect the MEDimage &quot;</span>\
                        <span class="s2">&quot;naming convention &#39;study-institution-id&#39; (Ex: Glioma-TCGA-001)&quot;</span><span class="p">)</span>

                <span class="c1"># Get MEDimage instances</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You have more than 10 MEDimage objects saved in the current DataManager instance, </span><span class="se">\</span>
<span class="s2">                        the rest of the instances will/can be saved locally only.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_instances</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ids</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span></div>

    <span class="k">def</span> <span class="nf">__read_all_niftis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reads all files in the initial path and organizes other path to images and roi</span>
<span class="sd">        in the class attributes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--&gt; Scanning all folders in initial directory&#39;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_to_niftis</span><span class="p">)</span>
        <span class="n">e_rglob1</span> <span class="o">=</span> <span class="s1">&#39;*.nii&#39;</span>
        <span class="n">e_rglob2</span> <span class="o">=</span> <span class="s1">&#39;*.nii.gz&#39;</span>

        <span class="c1"># EXTRACT ALL FILES IN THE PATH TO DICOMS</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">e_rglob1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_all</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">e_rglob2</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> must be a path to a directory&quot;</span><span class="p">)</span>

        <span class="n">all_niftis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_all</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_niftis</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s1">&#39;ROI&#39;</span> <span class="ow">in</span> <span class="n">all_niftis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_roi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_niftis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_niftis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__associate_roi_to_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">MEDimg</span><span class="p">:</span> <span class="n">MEDimage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MEDimage</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Extracts all ROI data from the given path for the given patient ID and updates all class attributes with</span>
<span class="sd">        the new extracted data.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_file(Union[Path, str]): Path to the ROI data.</span>
<span class="sd">            MEDimg (MEDimage): MEDimage class instance that will hold the data. </span>

<span class="sd">        Returns:</span>
<span class="sd">            MEDimage: Returns a MEDimage instance with updated roi attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
        <span class="n">roi_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_roi</span><span class="p">:</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="n">image_file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># id is PatientID__ImagingScanName</span>
            <span class="c1"># Load the patient&#39;s ROI nifti files:</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;ROI&#39;</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
                <span class="n">roi</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">roi_data</span> <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">convert_to_LPS</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">roi</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">())</span>
                <span class="n">roi_name</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)]</span>
                <span class="n">name_set</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)]</span>
                <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">update_indexes</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">roi_index</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">roi_data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
                <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">update_name_set</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">roi_index</span><span class="p">,</span> <span class="n">name_set</span><span class="o">=</span><span class="n">name_set</span><span class="p">)</span>
                <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">ROI</span><span class="o">.</span><span class="n">update_roi_name</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">roi_index</span><span class="p">,</span> <span class="n">roi_name</span><span class="o">=</span><span class="n">roi_name</span><span class="p">)</span>
                <span class="n">roi_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">MEDimg</span>

    <span class="k">def</span> <span class="nf">__associate_spatialRef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nifti_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">MEDimg</span><span class="p">:</span> <span class="n">MEDimage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MEDimage</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Computes the imref3d spatialRef using a NIFTI file and updates the spatialRef attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            nifti_file(Union[Path, str]): Path to the nifti data.</span>
<span class="sd">            MEDimg (MEDimage): MEDimage class instance that will hold the data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MEDimage: Returns a MEDimage instance with updated spatialRef attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Loading the nifti file :</span>
        <span class="n">nifti</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">nifti_file</span><span class="p">)</span>
        <span class="n">nifti_data</span> <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># spatialRef Creation</span>
        <span class="n">pixel_x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nifti</span><span class="o">.</span><span class="n">affine</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">pixel_y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nifti</span><span class="o">.</span><span class="n">affine</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nifti</span><span class="o">.</span><span class="n">affine</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">min_grid</span> <span class="o">=</span> <span class="n">nifti</span><span class="o">.</span><span class="n">affine</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="c1"># x and y are flipped</span>
        <span class="n">min_x_grid</span> <span class="o">=</span> <span class="n">min_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">min_y_grid</span> <span class="o">=</span> <span class="n">min_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">min_z_grid</span> <span class="o">=</span> <span class="n">min_grid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">size_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">nifti_data</span><span class="p">)</span>
        <span class="n">spatialRef</span> <span class="o">=</span> <span class="n">imref3d</span><span class="p">(</span><span class="n">size_image</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel_x</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel_y</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">slices</span><span class="p">))</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">XWorldLimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">XWorldLimits</span><span class="p">)</span> <span class="o">-</span>
                                <span class="p">(</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">XWorldLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                    <span class="p">(</span><span class="n">min_x_grid</span><span class="o">-</span><span class="n">pixel_x</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">YWorldLimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">YWorldLimits</span><span class="p">)</span> <span class="o">-</span>
                                <span class="p">(</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">YWorldLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                    <span class="p">(</span><span class="n">min_y_grid</span><span class="o">-</span><span class="n">pixel_y</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">ZWorldLimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">ZWorldLimits</span><span class="p">)</span> <span class="o">-</span>
                                <span class="p">(</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">ZWorldLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>
                                    <span class="p">(</span><span class="n">min_z_grid</span><span class="o">-</span><span class="n">slices</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Converting the results into lists</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">ImageSize</span> <span class="o">=</span> <span class="n">spatialRef</span><span class="o">.</span><span class="n">ImageSize</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">XIntrinsicLimits</span> <span class="o">=</span> <span class="n">spatialRef</span><span class="o">.</span><span class="n">XIntrinsicLimits</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">YIntrinsicLimits</span> <span class="o">=</span> <span class="n">spatialRef</span><span class="o">.</span><span class="n">YIntrinsicLimits</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">spatialRef</span><span class="o">.</span><span class="n">ZIntrinsicLimits</span> <span class="o">=</span> <span class="n">spatialRef</span><span class="o">.</span><span class="n">ZIntrinsicLimits</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># update spatialRef in the volume sub-class</span>
        <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">update_spatialRef</span><span class="p">(</span><span class="n">spatialRef</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MEDimg</span>

<div class="viewcode-block" id="DataManager.process_all"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.process_all">[docs]</a>    <span class="k">def</span> <span class="nf">process_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Processes both DICOM &amp; NIfTI content to create MEDimage classes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_all_dicoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_all_niftis</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataManager.process_all_niftis"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.process_all_niftis">[docs]</a>    <span class="k">def</span> <span class="nf">process_all_niftis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MEDimage</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;This function reads the NIfTI content of all the sub-folder tree of a starting directory. </span>
<span class="sd">        It then organizes the data in the MEDimage class including the region of  interest (ROI)</span>
<span class="sd">        defined by an associated mask file. All MEDimage classes hereby created are saved in a specific path</span>
<span class="sd">        with a name specific name varying with every scan.</span>

<span class="sd">        Args:</span>
<span class="sd">            None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[MEDimage]: List of MEDimage instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__read_all_niftis</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt; Reading all NIfTI objects (imaging volumes &amp; masks) to create MEDimage classes&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__nifti</span><span class="o">.</span><span class="n">stack_path_images</span><span class="p">):</span>
            <span class="c1"># INITIALIZE MEDimage INSTANCE AND UPDATE ATTRIBUTES</span>
            <span class="n">MEDimg</span> <span class="o">=</span> <span class="n">MEDimage</span><span class="p">()</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">patientID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">series_description</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)]</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;nifti&quot;</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">set_orientation</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;Axial&quot;</span><span class="p">)</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">set_patientPosition</span><span class="p">(</span><span class="n">patientPosition</span><span class="o">=</span><span class="s2">&quot;HFS&quot;</span><span class="p">)</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
            <span class="c1"># RAS to LPS</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">convert_to_LPS</span><span class="p">()</span>
            <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">scan_rot</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># UPDATE spatialRef</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__associate_spatialRef</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">MEDimg</span><span class="p">)</span>
            <span class="c1"># GET ROI</span>
            <span class="n">MEDimage_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__associate_roi_to_image</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">MEDimg</span><span class="p">)</span>
            
            <span class="c1"># User cannot save over 10 instances in the class</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You have more than 10 MEDimage objects saved in the current DataManager instance, </span><span class="se">\</span>
<span class="s2">                    the rest of the instances will/can be saved locally only.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__warned</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_instances</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MEDimage_instance</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">:</span>
                <span class="n">save_MEDimage</span><span class="p">(</span><span class="n">MEDimg</span><span class="p">,</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;scan&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">)</span>
            
            <span class="c1"># Update the path to the created instances</span>
            <span class="n">name_save</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_MEDimage_name_save</span><span class="p">(</span><span class="n">MEDimage_instance</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path_to_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span> <span class="o">/</span> <span class="n">name_save</span><span class="p">))</span>
            
            <span class="c1"># Update processing summary</span>
            <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">scan_type</span> <span class="o">=</span> <span class="n">name_save</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span> <span class="p">:</span> <span class="n">name_save</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__studies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># add new study</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__institutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># add new institution</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># add new study to summary</span>
                <span class="k">if</span> <span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># add new institution</span>
                <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__scans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">scan_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">name_save</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="n">name_save</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]][</span><span class="n">scan_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_save</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The patient ID of the following file: </span><span class="si">{</span><span class="n">name_save</span><span class="si">}</span><span class="s2"> does not respect the MEDimage &quot;</span>\
                    <span class="s2">&quot;naming convention &#39;study-institution-id&#39; (Ex: Glioma-TCGA-001)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span></div>

<div class="viewcode-block" id="DataManager.update_from_csv"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.update_from_csv">[docs]</a>    <span class="k">def</span> <span class="nf">update_from_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_csv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Updates the class from a given CSV and summarizes the processed scans again according to it.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_csv(optional, Union[str, Path]): Path to a csv file, if not given, will check</span>
<span class="sd">                for csv info in the class attributes.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">path_csv</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No csv provided, no updates will be made&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Extract roi type label from csv file name</span>
            <span class="n">name_csv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span><span class="o">.</span><span class="n">name</span>
            <span class="n">roi_type_label</span> <span class="o">=</span> <span class="n">name_csv</span><span class="p">[</span><span class="n">name_csv</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="n">name_csv</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>

            <span class="c1"># Create a dictionary</span>
            <span class="n">csv_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">csv_data</span><span class="p">[</span><span class="n">roi_type_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># Open a csv reader using DictReader</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvf</span><span class="p">:</span>
                <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csvf</span><span class="p">)</span>
                <span class="c1"># Convert each row into a dictionary</span>
                <span class="c1"># and add it to data</span>
                <span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
                    <span class="c1"># Assuming a column named &#39;No&#39; to</span>
                    <span class="c1"># be the primary key</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="s1">&#39;PatientID&#39;</span><span class="p">]</span>
                    <span class="n">csv_data</span><span class="p">[</span><span class="n">roi_type_label</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">rows</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">csv_data</span> <span class="o">=</span> <span class="n">csv_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summarize</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataManager.summarize"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.summarize">[docs]</a>    <span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and shows a summary of processed scans organized by study, institution, scan type and roi type</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">count_scans</span><span class="p">(</span><span class="n">summary</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">study</span> <span class="ow">in</span> <span class="n">summary</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">institution</span> <span class="ow">in</span> <span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">]:</span>
                                    <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">][</span><span class="n">scan</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">count</span>

        <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;study&#39;</span><span class="p">,</span> <span class="s1">&#39;institution&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_type&#39;</span><span class="p">,</span> <span class="s1">&#39;roi_type&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">study</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
            <span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                        <span class="s1">&#39;study&#39;</span><span class="p">:</span> <span class="n">study</span><span class="p">,</span>
                                        <span class="s1">&#39;institution&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                        <span class="s1">&#39;scan_type&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                        <span class="s1">&#39;roi_type&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                        <span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="n">count_scans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
                                        <span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">institution</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">]:</span>
                <span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                            <span class="s1">&#39;study&#39;</span><span class="p">:</span> <span class="n">study</span><span class="p">,</span>
                                            <span class="s1">&#39;institution&#39;</span><span class="p">:</span> <span class="n">institution</span><span class="p">,</span>
                                            <span class="s1">&#39;scan_type&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                            <span class="s1">&#39;roi_type&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                            <span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="n">count_scans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">])</span>
                                            <span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">]:</span>
                    <span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                                <span class="s1">&#39;study&#39;</span><span class="p">:</span> <span class="n">study</span><span class="p">,</span>
                                                <span class="s1">&#39;institution&#39;</span><span class="p">:</span> <span class="n">institution</span><span class="p">,</span>
                                                <span class="s1">&#39;scan_type&#39;</span><span class="p">:</span> <span class="n">scan</span><span class="p">,</span>
                                                <span class="s1">&#39;roi_type&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                                <span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="n">count_scans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="n">study</span><span class="p">][</span><span class="n">institution</span><span class="p">][</span><span class="n">scan</span><span class="p">])</span>
                                                <span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_data</span><span class="p">:</span>
                        <span class="n">patient_id</span> <span class="o">=</span> <span class="n">scan</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">roi_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_data</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">csv_data</span><span class="p">[</span><span class="n">roi_type</span><span class="p">]:</span>
                                <span class="k">break</span>
                            <span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                                <span class="s1">&#39;study&#39;</span><span class="p">:</span> <span class="n">study</span><span class="p">,</span>
                                                <span class="s1">&#39;institution&#39;</span><span class="p">:</span> <span class="n">institution</span><span class="p">,</span>
                                                <span class="s1">&#39;scan_type&#39;</span><span class="p">:</span> <span class="n">scan</span><span class="p">,</span>
                                                <span class="s1">&#39;roi_type&#39;</span><span class="p">:</span> <span class="n">roi_type</span><span class="p">,</span>
                                                <span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="mi">1</span>
                                                <span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">summary_df</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="DataManager.pre_checks_init"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.pre_checks_init">[docs]</a>    <span class="k">def</span> <span class="nf">pre_checks_init</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">path_save_checks</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> 
            <span class="n">path_csv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
            <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initializes all the class attributes needed to run pre-radiomics check methods.</span>

<span class="sd">        This method is useful to make sure all the important attributes are ready before running</span>
<span class="sd">        radiomics pre-checks, in case these attributes were not specified during the class initialization.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_save_checks(Union[Path, str]): Path to where the radiomics checks are gonna be saved.</span>
<span class="sd">            path_csv(Union[Path, str]): Path to the csv file that will be used to read scans.</span>
<span class="sd">            force(bool, optional): If True, will replace the values of the existing attributes and</span>
<span class="sd">                will skip (keep the originals) if false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="ow">and</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">=</span> <span class="n">path_save_checks</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span> <span class="ow">and</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span> <span class="o">=</span> <span class="n">path_csv</span></div>

    <span class="k">def</span> <span class="nf">__pre_radiomics_checks_dimensions</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="p">,</span> 
                                        <span class="n">wildcards_dimensions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> 
                                        <span class="n">use_instances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
                                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Finds proper dimensions options for radiomics analyses for a group of scans</span>

<span class="sd">        Args:</span>
<span class="sd">            wildcards_dimensions(List[str], optional): List of wildcards that determines the scans </span>
<span class="sd">                that will be analyzed. You can learn more about wildcards in</span>
<span class="sd">                :ref:`this link &lt;https://www.linuxtechtips.com/2013/11/how-wildcards-work-in-linux-and-unix.html&gt;`.</span>
<span class="sd">            use_instances(bool, optional): If True will use the instances of the MEDimage class saved in DataManager</span>
<span class="sd">                for the analysis. If False, will analyze scans in the path where the instances were saved.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xy_dim</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;p5&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;p95&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="n">z_dim</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;p5&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;p95&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wildcards_dimensions</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">wildcards_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">wildcards_dimensions</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wildcards_dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_instances</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wildcard is empty and instances use is not allowed, the pre-checks will be aborted&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># TODO: seperate by studies and scan type (MRscan, CTscan...)</span>
        <span class="c1"># TODO: Two summaries (df, list of names saves) -&gt; </span>
        <span class="c1"># name_save = name_save(ROI) : Glioma-Huashan-001__T1.MRscan.npy({GTV})</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wildcards_dimensions</span><span class="p">)):</span>
            <span class="n">wildcard</span> <span class="o">=</span> <span class="n">wildcards_dimensions</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">use_instances</span><span class="p">:</span>
                <span class="n">wildcard</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">study</span><span class="p">,</span> <span class="n">scan_type</span> <span class="o">=</span> <span class="n">wildcard</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">n_instances</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_instances</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_instances</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">))):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">MEDimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">patientID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">study</span> <span class="ow">and</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">scan_type</span><span class="p">:</span>
                            <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">PixelExtentInWorldX</span>
                            <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">PixelExtentInWorldZ</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="c1"># Running analysis</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;p5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;p95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">95</span><span class="p">)</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;p5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;p95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">95</span><span class="p">)</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="c1"># Saving files using wildcard for name</span>
                <span class="n">wildcard</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
                <span class="n">save_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;xyDim_&#39;</span> <span class="o">+</span> <span class="n">wildcard</span><span class="p">),</span> <span class="n">xy_dim</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
                <span class="n">save_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;zDim_&#39;</span> <span class="o">+</span> <span class="n">wildcard</span><span class="p">),</span> <span class="n">z_dim</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_paths</span> <span class="o">=</span> <span class="n">get_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">,</span> <span class="n">wildcard</span><span class="p">)</span>
                <span class="n">n_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_files</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_files</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">))):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">MEDimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">PixelExtentInWorldX</span>
                        <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">f</span><span class="p">]</span>  <span class="o">=</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">spatialRef</span><span class="o">.</span><span class="n">PixelExtentInWorldZ</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;p5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;p95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">95</span><span class="p">)</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;p5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;p95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">95</span><span class="p">)</span>
                <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xy_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_dim</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                <span class="c1"># Saving files using wildcard for name</span>
                <span class="n">wildcard</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
                <span class="n">save_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;xyDim_&#39;</span> <span class="o">+</span> <span class="n">wildcard</span><span class="p">),</span> <span class="n">xy_dim</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
                <span class="n">save_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;zDim_&#39;</span> <span class="o">+</span> <span class="n">wildcard</span><span class="p">),</span> <span class="n">z_dim</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pre_radiomics_checks_window</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> 
            <span class="n">wildcards_window</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[],</span> 
            <span class="n">use_instances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">path_csv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Finds proper re-segmentation ranges options for radiomics analyses for a group of scans</span>

<span class="sd">        Args:</span>
<span class="sd">            wildcards_window(List[str], optional): List of wildcards that determines the scans </span>
<span class="sd">            that will be analyzed. You can learn more about wildcards in</span>
<span class="sd">                :ref:`this link &lt;https://www.linuxtechtips.com/2013/11/how-wildcards-work-in-linux-and-unix.html&gt;`.</span>
<span class="sd">            use_instances(bool, optional): If True will use the instances of the MEDimage class saved in DataManager</span>
<span class="sd">                for the analysis. If False, will analyze scans in the path where the instances were saved.</span>
<span class="sd">            path_csv(Union[str, Path], optional): Path to a csv file containing a list of the scans that will be</span>
<span class="sd">                analyzed (a CSV file for a single ROI type).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">roi_data</span><span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;p5&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;p95&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">wildcards_window</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">wildcards_window</span> <span class="o">=</span> <span class="p">[</span><span class="n">wildcards_window</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wildcards_window</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wilcards is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">path_csv</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_csv</span><span class="p">)</span>
        <span class="n">roi_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span><span class="p">)</span>
        <span class="n">roi_names</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[],</span> <span class="p">[]]</span>
        <span class="n">roi_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi_table</span><span class="p">[</span><span class="s1">&#39;PatientID&#39;</span><span class="p">]</span>
        <span class="n">roi_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi_table</span><span class="p">[</span><span class="s1">&#39;ImagingScanName&#39;</span><span class="p">]</span>
        <span class="n">roi_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi_table</span><span class="p">[</span><span class="s1">&#39;ImagingModality&#39;</span><span class="p">]</span>
        <span class="n">patient_names</span> <span class="o">=</span> <span class="n">get_patient_names</span><span class="p">(</span><span class="n">roi_names</span><span class="p">)</span>

        <span class="n">temp_val</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wildcards_window</span><span class="p">)):</span>
            <span class="n">wildcard</span> <span class="o">=</span> <span class="n">wildcards_window</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_instances</span><span class="p">:</span>
                <span class="n">file_paths</span> <span class="o">=</span> <span class="n">get_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save</span><span class="p">,</span> <span class="n">wildcard</span><span class="p">)</span>
                <span class="n">n_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_files</span><span class="p">)):</span>
                    <span class="n">file</span> <span class="o">=</span> <span class="n">file_paths</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">patient_name</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="n">ext</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">MEDimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;PTscan&#39;</span><span class="p">,</span> <span class="n">wildcard</span><span class="p">)</span> <span class="ow">and</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;nifti&#39;</span><span class="p">:</span>
                            <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">compute_suv_map</span><span class="p">(</span>
                                                        <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> 
                                                        <span class="n">MEDimg</span><span class="o">.</span><span class="n">dicomH</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">patient_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">patient_names</span><span class="p">)</span>
                        <span class="n">ind_roi</span> <span class="o">=</span> <span class="n">patient_names</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">patient_name</span><span class="p">)</span>
                        <span class="n">name_roi</span> <span class="o">=</span> <span class="n">roi_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_roi</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">vol_obj_init</span><span class="p">,</span> <span class="n">roi_obj_init</span> <span class="o">=</span> <span class="n">get_roi_from_indexes</span><span class="p">(</span><span class="n">MEDimg</span><span class="p">,</span> <span class="n">name_roi</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">vol_obj_init</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">roi_obj_init</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">temp_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_files</span><span class="p">,</span> <span class="n">temp_val</span><span class="p">[</span><span class="n">f</span><span class="p">])))</span>
                        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">))):</span>
                    <span class="n">wildcard</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">study</span><span class="p">,</span> <span class="n">scan_type</span> <span class="o">=</span> <span class="n">wildcard</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">MEDimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">patient_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_MEDimage_name_save</span><span class="p">(</span><span class="n">MEDimg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">patientID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">study</span> <span class="ow">and</span> <span class="n">MEDimg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">scan_type</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;PTscan&#39;</span><span class="p">,</span> <span class="n">wildcard</span><span class="p">):</span>
                                <span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">compute_suv_map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">MEDimg</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> 
                                                                            <span class="n">MEDimg</span><span class="o">.</span><span class="n">dicomH</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                            <span class="n">patient_names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">patient_names</span><span class="p">)</span>
                            <span class="n">ind_roi</span> <span class="o">=</span> <span class="n">patient_names</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">patient_name</span><span class="p">)</span>
                            <span class="n">name_roi</span> <span class="o">=</span> <span class="n">roi_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_roi</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                            <span class="n">vol_obj_init</span><span class="p">,</span> <span class="n">roi_obj_init</span> <span class="o">=</span> <span class="n">get_roi_from_indexes</span><span class="p">(</span><span class="n">MEDimg</span><span class="p">,</span> <span class="n">name_roi</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="n">vol_obj_init</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">roi_obj_init</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="n">temp_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
                            <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">),</span> <span class="n">temp_val</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                            <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with patient </span><span class="si">{</span><span class="n">patient_name</span><span class="si">}</span><span class="s2">, scan or roi not found&quot;</span><span class="p">)</span>
                            <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                        <span class="k">continue</span>

        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])])</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;p5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;p95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])],</span> <span class="mi">95</span><span class="p">)</span>
        <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># save final checks</span>
        <span class="n">wildcard</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
        <span class="n">save_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/</span> <span class="p">(</span><span class="s1">&#39;roi_data_&#39;</span> <span class="o">+</span> <span class="n">wildcard</span><span class="p">),</span> <span class="n">roi_data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>

<div class="viewcode-block" id="DataManager.pre_radiomics_checks"><a class="viewcode-back" href="../../../MEDimage.wrangling.html#MEDimage.wrangling.DataManager.DataManager.pre_radiomics_checks">[docs]</a>    <span class="k">def</span> <span class="nf">pre_radiomics_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">wildcards_dimensions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[],</span>
                            <span class="n">wildcards_window</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[],</span>
                            <span class="n">use_instances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">path_csv</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Finds proper dimension and re-segmentation ranges options for radiomics analyses. </span>

<span class="sd">        The resulting files from this method can then be analyzed and used to set up radiomics </span>
<span class="sd">        parameters options in computation methods.</span>

<span class="sd">        Args:</span>
<span class="sd">            wildcards_dimensions(List[str], optional): List of wildcards that determines the scans </span>
<span class="sd">                that will be analyzed. You can learn more about wildcards in</span>
<span class="sd">                :ref:`this link &lt;https://www.linuxtechtips.com/2013/11/how-wildcards-work-in-linux-and-unix.html&gt;`.</span>
<span class="sd">            wildcards_window(List[str], optional): List of wildcards that determines the scans </span>
<span class="sd">                that will be analyzed. You can learn more about wildcards in</span>
<span class="sd">                :ref:`this link &lt;https://www.linuxtechtips.com/2013/11/how-wildcards-work-in-linux-and-unix.html&gt;`.</span>
<span class="sd">            use_instances(bool, optional): If True will use the instances of the MEDimage class saved in DataManager</span>
<span class="sd">                for the analysis. If False, will analyze scans in the path where the instances were saved.</span>
<span class="sd">            path_csv(Union[str, Path], optional): Path to a csv file containing a list of the scans that will be</span>
<span class="sd">                analyzed (a CSV file for a single ROI type).</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialization</span>
        <span class="n">path_study</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>

        <span class="c1"># Load params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_pre_checks_settings</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wildcards_dimensions</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">wildcards_window</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;path to pre-checks settings is None.</span><span class="se">\</span>
<span class="s2">                    wildcards_dimensions and wildcards_window need to be specified&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_pre_checks_settings</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;pre_radiomics_checks&#39;</span><span class="p">]</span>  

            <span class="c1"># Setting up paths</span>
            <span class="k">if</span> <span class="s1">&#39;path_save_checks&#39;</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;path_save_checks&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;path_save_checks&#39;</span><span class="p">])</span> 
            <span class="k">if</span> <span class="s1">&#39;path_csv&#39;</span> <span class="ow">in</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;path_csv&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_csv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;path_csv&#39;</span><span class="p">])</span> 

            <span class="c1"># Wildcards of groups of files to analyze for dimensions in path_data.</span>
            <span class="c1"># See for example: https://www.linuxtechtips.com/2013/11/how-wildcards-work-in-linux-and-unix.html</span>
            <span class="c1"># Keep the cell empty if no dimension checks are to be performed.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wildcards_dimensions</span><span class="p">:</span>
                <span class="n">wildcards_dimensions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;wildcards_dimensions&#39;</span><span class="p">])):</span>
                    <span class="n">wildcards_dimensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;wildcards_dimensions&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># ROI intensity window checks params</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wildcards_window</span><span class="p">:</span>
                <span class="n">wildcards_window</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;wildcards_window&#39;</span><span class="p">])):</span>
                    <span class="n">wildcards_window</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;wildcards_window&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># PRE-RADIOMICS CHECKS</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">path_study</span> <span class="o">/</span> <span class="s1">&#39;checks&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_study</span> <span class="o">/</span> <span class="s1">&#39;checks&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_study</span> <span class="o">/</span> <span class="s1">&#39;checks&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_study</span> <span class="o">/</span> <span class="s1">&#39;checks&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;checks&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/</span> <span class="s1">&#39;checks&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/=</span> <span class="s1">&#39;checks&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span> <span class="o">/=</span> <span class="s1">&#39;checks&#39;</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">_path_save_checks</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">************************* PRE-RADIOMICS CHECKS *************************&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># 1. PRE-RADIOMICS CHECKS -- DIMENSIONS</span>
        <span class="n">start1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--&gt; PRE-RADIOMICS CHECKS -- DIMENSIONS ... &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pre_radiomics_checks_dimensions</span><span class="p">(</span><span class="n">wildcards_dimensions</span><span class="p">,</span> <span class="n">use_instances</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">time1</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Elapsed time: </span><span class="si">{</span><span class="n">time1</span><span class="si">}</span><span class="s1"> sec&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># 2. PRE-RADIOMICS CHECKS - WINDOW</span>
        <span class="n">start2</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--&gt; PRE-RADIOMICS CHECKS -- WINDOW ... </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pre_radiomics_checks_window</span><span class="p">(</span><span class="n">wildcards_window</span><span class="p">,</span> <span class="n">use_instances</span><span class="p">,</span> <span class="n">path_csv</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">time2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Elapsed time: </span><span class="si">{</span><span class="n">time2</span><span class="si">}</span><span class="s1"> sec&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--&gt; TOTAL TIME FOR PRE-RADIOMICS CHECKS: </span><span class="si">{</span><span class="n">time_elapsed</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------------------------------------------------------------------------------&#39;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, MEDimage.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>